@page
@model CinemaBookingRazor.Pages.IndexModel
@{
    ViewData["Title"] = "Home";
}

<section class="hero py-5">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-8">
                <h1 class="display-5 hero-title">
                    Welcome to CGV Ninh Kieu
                </h1>
                <p class="lead hero-sub">Find showtimes, choose seats and book tickets quickly. Enjoy the latest movies.</p>
            </div>
        </div>
    </div>
</section>

<div class="container main-content">
    <div class="row">
        <div class="col-lg-9">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3 class="section-title">Now Showing</h3>
                <small class="text-muted">Updated frequently</small>
            </div>

            <div class="row">
                @if (Model.Movies == null || !Model.Movies.Any())
                {
                    <div class="col-12">
                        <div class="alert alert-info">No movies available.</div>
                    </div>
                }
                else
                {
                    foreach (var m in Model.Movies)
                    {
                        <div class="col-sm-6 col-md-4 mb-4">
                            <div class="card movie-card h-100">
                                <img src="@(string.IsNullOrWhiteSpace(m.PosterUrl) ? "/img/no-poster.png" : m.PosterUrl)" class="card-img-top poster" alt="@m.Title" />
                                <div class="card-body d-flex flex-column">
                                    <h5 class="card-title">@m.Title</h5>
                                    <p class="card-text mb-1 text-muted">@m.Genre</p>
                                    <p class="card-text mb-2"><small class="text-muted">@((m.Duration ?? 0)) mins</small></p>
                                    <div class="mt-auto d-flex justify-content-between align-items-center">
                                        <strong class="price">@((m.Price.HasValue) ? $"{m.Price:0,#}" : "-")</strong>
                                        <a class="btn btn-sm btn-cinema" asp-page="/Showtime/Index" asp-route-movieId="@m.Id">View times</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    }
                }
            </div>
            @if (Model.TotalPages > 1)
            {
                <nav aria-label="Movie pages">
                    <ul class="pagination justify-content-center mt-4">
                        @for (int i = 1; i <= Model.TotalPages; i++)
                        {
                            <li class="page-item @(i == Model.CurrentPage ? "active" : "")">
                                <a class="page-link"
                                   asp-page="/Index"
                                   asp-route-page="@i">@i</a>
                            </li>
                        }
                    </ul>
                </nav>
            }
        </div>

        <div class="col-lg-3">
            <div class="card auth-card mb-4">
                <div class="card-body">
                    @if (User?.Identity?.IsAuthenticated == true)
                    {
                        <h5 class="card-title text-light">Welcome back</h5>
                        <p class="text-light mb-2">Hello, @User.Identity.Name</p>

                        @if (User.IsInRole("Admin"))
                        {
                            <a class="btn btn-cinema w-100 mb-2" href="/AdminPage/AdminPage">Dashboard</a>
                        }
                        else if (User.IsInRole("Staff"))
                        {
                            <a class="btn btn-cinema w-100 mb-2" href="/StaffPage/StaffPage">Dashboard</a>
                        }
                        else
                        {
                            <a class="btn btn-outline-light btn-sm me-2" asp-page="/Bookings/MyBookings">My bookings</a>
                        }

                        <form method="post" asp-page-handler="Logout" class="d-inline mt-2">
                            <button type="submit" class="btn btn-danger btn-sm">Logout</button>
                        </form>
                    }
                    else
                    {
                        <h5 class="card-title text-light">Sign in</h5>
                        <p class="text-muted small">Login to make bookings and access member prices.</p>
                        <a class="btn btn-cinema w-100 mb-2" asp-page="/Account/Login">Login</a>
                        <a class="btn btn-outline-cinema w-100" asp-page="/Account/Register">Register</a>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

<style>
/* Page-scoped dark cinema theme (no sidebar) */
:root{
  --cinema-black: #0b0c0d;
  --cinema-dark: #0f1112;
  --cinema-yellow: #ffd54f;
  --muted: #9aa0a4;
}

/* page background and text */
body {
  background: var(--cinema-black);
  color: #e6e9eb;
}

/* Hero */
.hero { background: linear-gradient(90deg, rgba(16,16,16,0.95), rgba(16,16,16,0.85)); }
.hero-title { color: #fff; margin-bottom: .2rem; }
.hero-sub { color: var(--muted); }

/* main content container spacing */
.main-content { padding-bottom: 60px; }

/* Movie cards - dark style */
.movie-card {
  background: linear-gradient(180deg, #0f1112, #0b0c0d);
  border: 1px solid rgba(255,255,255,0.03);
  color: #e6e9eb;
  box-shadow: 0 6px 18px rgba(0,0,0,0.5);
  border-radius: 6px;
}
.movie-card .poster {
  height: 320px;
  object-fit: cover;
  background: #141416;
  border-top-left-radius: 6px;
  border-top-right-radius: 6px;
}
.movie-card .card-body { padding: 14px; }
.section-title { color: #fff; }

/* price and button */
.price { color: var(--cinema-yellow); font-weight:700; }
.btn-cinema {
  background: var(--cinema-yellow);
  color: #111;
  border: 1px solid #e6c200;
}
.btn-cinema:hover { background: #e6c100; color: #111; }

/* outline cinema */
.btn-outline-cinema {
  background: transparent;
  color: var(--cinema-yellow);
  border: 1px solid var(--cinema-yellow);
}
.btn-outline-cinema:hover { background: var(--cinema-yellow); color:#111; }

/* Auth card: dark background to match theme */
.auth-card {
  background: linear-gradient(180deg, #131415, #0f1112);
  color: #e6e9eb;
  border: 1px solid rgba(255,255,255,0.04);
  box-shadow: 0 6px 18px rgba(0,0,0,0.45);
}
.auth-card .card-body { padding: 18px; }
.auth-card .card-title { margin-bottom: .5rem; color: #fff; }

/* make the small helper text readable */
.text-muted { color: var(--muted) !important; }

/* responsive tweaks */
@@media (max-width: 991px) {
  .hero-image { display:none; }
  .main-content { padding-left: 12px; padding-right: 12px; }
}
</style>